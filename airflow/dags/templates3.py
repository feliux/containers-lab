from airflow.models import DAG
from airflow.operators.bash_operator import BashOperator
from datetime import datetime

filelist = [f"file{x}.txt" for x in range(30)]

default_args = {
  "start_date": datetime(2020, 4, 15),
}

cleandata_dag = DAG(
    "cleandata",
    default_args=default_args,
    schedule_interval="@daily"
)

# Modify the template to handle multiple files in a 
# single run.
templated_command = """
  <% for filename in params.filenames %>
  bash cleandata.sh {{ ds_nodash }} {{ filename }};
  <% endfor %>
"""

# Modify clean_task to use the templated command
clean_task = BashOperator(
    task_id="cleandata_task",
    bash_command=templated_command,
    params={
        "filenames": filelist
        },
        dag=cleandata_dag
)